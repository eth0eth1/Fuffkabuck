<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="http://fonts.googleapis.com/
css?family=Open+Sans:400,300" />
<meta charset="UTF-8"/>
<title>Weathergrid</title>
</head>
<body>

    <canvas id ="weatherGrid" width="600" height="600" >
                Your browser does not support this HTML5 tag, that sucks!
    </canvas>

<!--This script below is for drawing onto the canvas defined above as 'demoCanvas'-->

<script>
var ctx = document.getElementById("weatherGrid").getContext("2d");


//Work these into the createGrid function
var tile_width = 20;
var tile_height = 20;

//Define this early
var weather;

//Change canvas size
ctx.canvas.width = tile_width*100;
ctx.canvas.height = tile_height*100;


getWeather("London");

window.setInterval(function(){
  generateColorGrid(10,10);
}, 100);


function generateColorGrid(x,y)
{
    // Check what vars we were called with
    //console.log ('generateColorGrid was called with ' + x + ' and ' + y);
    if (typeof x !== 'number') {
        x = 10;
        y = 10;
    } else {
        // If y is not a number, but x is; set y to x.
        if (typeof y !== 'number') {
            y = x;
        }
    }
    // Loop through x & y values passed
    for(xcount = x; xcount>0; xcount--){
        for(ycount = y; ycount>0; ycount--){
            //console.log("X:" + xcount + "Y:" + ycount);
            colorArray = getColor(weather);
            //console.log("colorArray = " + colorArray);
            ctx.fillStyle = "rgb("+colorArray[0]+","+colorArray[1]+","+colorArray[2]+")";
            ctx.fillRect(ycount * tile_width, xcount * tile_height, tile_width, tile_height);  
        }   
    }
}

function getColor(str){

    switch(true){

        case /rain/.test(str):
        var r = Math.floor((Math.random()*225)+1);
        var g = Math.floor((Math.random()*225)+1);
        var b = 225;
        return [r,g,b];

        case /sun/.test(str):
        var r = 225;
        var g = Math.floor((Math.random()*225)+1);
        var b = Math.floor((Math.random()*225)+1);
        return [r,g,b];

        case /cloud/.test(str):
        var r = Math.floor( (Math.random()* (50 - 1) ));
        var g = Math.floor( (Math.random()* (175- 1) ));
        var b = 255;
        return [r,g,b];

        case /ice/.test(str):
        var r = Math.floor( (Math.random()* (50 - 1) ));
        var g = Math.floor( (Math.random()* (175- 1) ));
        var b = 255;
        return [r,g,b];

        case /thunder/.test(str):
        var r = Math.floor( (Math.random()* (226 - 75) ));
        var g = Math.floor((Math.random()*226)+1);
        var b = Math.floor( (Math.random()* (226 - 75) ));
        return [r,g,b];

        default:
        //console.log("rndnum = "+rndnum);
        var r = Math.floor((Math.random()*225)+1);
        var g = Math.floor((Math.random()*225)+1);
        var b = 225;

        return [r,g,b];

    }

}

// Elly: 2014-08-03
// Function for getting current weather of location as a string.
function getWeather(loc){
    
    if(typeof weather === 'undefined'){

        console.log("Getting weather from the internet...");

    // See definitions from http://openweathermap.org/weather-conditions
    var url = "http://api.openweathermap.org/data/2.5/find?q=" + loc + "&units=metric";
    // Initialise the HTTP request client
    var client = new XMLHttpRequest();

    //
    weather
    try {
        client.open("GET", url, false);
        client.send();
        var response = JSON.parse(client.responseText);
        weather = response.list[0].weather[0].description;
    }
    catch(err){
        console.log("Failed to get weather, defaulting to Rain");
        weather = "Rain";
    }
    console.log('Weather: ' + weather);
    } else{

        console.log("Weather already set; returning pre-cached weather...");

    }


}
</script>

</body>
</html>