<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="style.css" />
<link rel="stylesheet" href="http://fonts.googleapis.com/
css?family=Open+Sans:400,300" />
<meta charset="UTF-8"/>
<title>BitPixel About Me</title>

</head>

<body>
<header>
<h1>Finley Peters | BitPixel </h1>
<nav class="topnav">
    <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About Me</a></li>
        <li><a href="work.html">Work</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="demo.html">Demo</a></li>
    </ul>
</nav>
</header>
<article>
    <div class="content">
        <img class="splash" src="img/splash1.png">
        <img class="splash" src="img/splash2.png">
        <img class="splash" src="img/splash3.png">
        
<canvas id ="demoCanvas" width="600" height="600" style="border:1px solid #000000;" >
            Your browser does not support this HTML5 tag, that sucks!
</canvas>
<p> This is a test page. For now. </p>

<!--This script below is for drawing onto the canvas defined above as 'demoCanvas'-->
<script src="testobject.js"> </script>  
<script>
//***************************//
//*****The import block******//
//***************************//
var imported = document.createElement('script');
imported.src = 'blurimage.js';
document.head.appendChild(imported);


console.log(spinningCube)
// Elly 2014-08-02
// Replaced hard coded test array with createGrid function
//var testArray = createGrid(15,15);
//var ROW = testArray.length;
//var COL = testArray[0].length;

var tile_width = 40;
var tile_height = 40;
var gridx = 10
var gridy = 5
var c = document.getElementById("demoCanvas");
var ctx = c.getContext("2d");
var weather;

// Elly 2014-08-02
// Shim in place to set testArray & ROW/COL
//window.alert (createGrid(10,10));


//This for loop cycles through, updating values into the array as it works through

ctx.canvas.width = tile_width*gridx;
ctx.canvas.height = tile_height*gridy;

getWeather("London");
switchWeather(weather);

generateColorGrid(10,5);

window.setInterval(function(){
  generateColorGrid();
}, 100);

//ctx.style.webkitFilter = "blur(10px)";


//Replaces drawColourGrid and generateGrid
function generateColorGrid(x,y)
{
    // Check what vars we were called with
    console.log ('generateColorGrid was called with ' + x + ' and ' + y);
    if (typeof x !== 'number') {
        x = 10;
        y = 10;
    } else {
        // If y is not a number, but x is; set y to x.
        if (typeof y !== 'number') {
            y = x;
        }
    }
    // Loop through x & y values passed
    for(xcount = x; xcount>0; xcount--){
        for(ycount = y; ycount>0; ycount--){
            console.log("X:" + xcount + "Y:" + ycount);
            hexString = switchWeather(weather);
            ctx.fillStyle = hexString;
            ctx.fillRect(ycount * tile_width, xcount * tile_height, tile_width, tile_height);  
        }   
    }
}

//Fen 2014-08-04
//Cleaned up switchWeather and generateColour functions to consolodate them into one super function.
function switchWeather(str){


    rndcolor = "#"+(Math.random().toString(16) + '0000000').slice(2, 8);
    //console.log("random hex code = " + rndcolor);

    switch(true){

    case /rain/.test(str):
              //console.log("Matched 'Rain'");
              var color = rndcolor.replace(/(\#)(.{2})(.{2})(.{2})/g, "$1$272FF");
                return color;
            break;

    case /sun/.test(str):
                console.log("Matched 'sun'");
                var color = rndcolor.replace(/(\#)(.{2})(.{2})(.{2})/g, "$1FF$3$4");
                return color;
            break;

    case /cloud/.test(str):
                console.log("Matched 'cloud'");
                var color = rndcolor.replace(/(\#)(.{2})(.{2})(.{2})/g, "$17272$4");
                //console.log("reformed hex code = " + color);
                return color;
            break;

    case /thunder/.test(str):
                console.log("Matched 'thunder'");
                var color = rndcolor.replace(/(\#)(.{2})(.{2})(.{2})/g, "$172FF$4");
                return color;
            break;

    default:
            console.log("Matched nothing, do a default thing or whatever")
        }
}


// Elly: 2014-08-03
// Function for getting current weather of location as a string.
function getWeather(loc){
    
    if(typeof weather === 'undefined'){

        console.log("Getting weather from the internet...");

    // See definitions from http://openweathermap.org/weather-conditions
    var url = "http://api.openweathermap.org/data/2.5/find?q=" + loc + "&units=metric";
    // Initialise the HTTP request client
    var client = new XMLHttpRequest();

    //
    weather
    try {
        client.open("GET", url, false);
        client.send();
        var response = JSON.parse(client.responseText);
        weather = response.list[0].weather[0].description;
    }
    catch(err){
        console.log("Failed to get weather, defaulting to Rain");
        weather = "Rain";
    }
    console.log('Weather: ' + weather);
    } else{

        console.log("Weather already set; returning pre-cached weather...");

    }


}


</script>


    </div>
</article>
</body>
</html>